# 0x07 查找

## 一、查找的基本概念

- 查找：在数据集合中寻找满足某种条件的数据元素的过程
- 查找表：用于查找的数据集合
- 关键字：**唯一**标识数据元素的数据项
- 静态查找表：只需要查找符合条件的数据元素
- 动态查找表：既要查找符合条件的数据元素，也要进行插入、删除操作
- 查找长度：需要比对关键字的次数
- 平均查找长度：所有查找过程中进行关键字的比较次数的平均值

## 二、顺序查找

- 0号位置存哨兵，即待查找的元素。然后倒序遍历

- 时间复杂度$O(n)$

- 对有序表的查找优化：当关键字大于（或小于）目标关键字时，查找失败。查找失败时ASL更少

  - 共n+1种查找失败的情况，因为在升序查找表中，对最后一个元素查找失败既可能是因为待查元素小于它也可能是因为大于它

- 查找判定树

  ![image-20220928091516697](assets/image-20220928091516697.png)

## 三、折半查找

#### 算法实现

```c++
//左闭右闭区间
int binary_search(SSTable L, ElemType key){
	int left = 0, right = L.length - 1, mid;
    while(low <= high){
        mid = (low+high)/2;
        if(L.elem[mid]==key) return mid;
        else if(L.elem[mid]>key) high = mid - 1;
        else low = mid + 1;
    }
    return -1;
}
```

#### 查找判定树

![image-20220928092542439](assets/image-20220928092542439.png)

绿色为成功结点，紫色为失败结点

- 折半查找的判定树中，若使用$mid = \lfloor(low+high)/2\rfloor$，则右子树结点数-左子树结点数=0或1
- 折半查找判定树一定是平衡二叉树
- 元素个数为n时，树高$h = \lceil log_2(n+1)\rceil$

#### 查找效率

时间复杂度$O(log_2n)$

一般情况下折半查找比顺序查找效率更优秀，但并不是任何情况下都更优秀

## 四、分块查找

#### 算法思想

特点：块内无序，块间有序

1. 根据块内元素的最大值建立块的索引表
2. 用折半查找找到待查元素可能所在的块
   - 情况一：待查元素恰好就是索引值——`a[mid] == val`时确定块的位置
   - 情况二：待查元素在表中存在，但不是索引值——当进行到`left==right`时有一次判定，此时`mid`所指的块就是`val`所在的块，但因为`val`不是该块的索引值，判定会失败，又因为`val<index`，会进行`right--`，而`left`还停留在原来的位置。因此最终折半查找结束时，`left`所指的块就是`val`所在的块。
   - 情况三：待查元素不在表中——最终折半查找结束时，`low`会超出索引表范围。
3. 块内再用顺序查找

#### 查找效率 

- 平均查找长度：设索引查找和块内查找的平均查找长度分别为$L_1$、$L_s$，则分块的平均查找长度为$ASL=L_1+L_s$
- 设长度为$n$的查找表被均分成$b$块，每块$s$个元素
  - 若对该查找表的块间、块内都采用顺序查找，则$L_1 = \frac{1+2+3+...+b}{b}=\frac{b+1}{2}$，$L_s=\frac{1+2+3+...+s}{b}=\frac{s+1}{2}$，$ASL=\frac{b+1}{2}+\frac{s+1}{2}=\frac{s^2+2s+n}{2s}$，当$s=\sqrt{n}$时，ASL取得最小值$\sqrt{n}+1$
  - 若对该查找表的块间采用折半查找、块内采用顺序查找，则$L_1=\lceil\log_2{b+1}\rceil$，$L_2$不变，$ASL=L_1=\lceil\log_2{b+1}\rceil+\frac{s+1}{2}$

## 五、B树与B+树

#### 5.1 B树/多路平衡查找树

- B树就是把二叉查找树变成$m$叉查找树，既保留排序特性，也保留平衡特性（规定对于任何一个结点，其所有子树的高度都要相同）

- 在二叉查找树中，每个结点都用一个关键字把搜索区域切成了两部分；在m叉查找树中，一个结点可以包含$n$个关键字，从而把搜索范围切成$n+1$个部分，即该结点的分叉有$n+1$个。

  ![image-20220928102713346](assets/image-20220928102713346.png)

- B树中所有结点的孩子个数的最大值称为B树的阶。

- 所有的叶结点都出现在同一层，并且不带信息（即类似于失败结点）。

- 除根结点外的所有非叶结点至少有$\lceil m/2 \rceil$棵子树，即至少含有$\lceil m/2 \rceil-1$个关键字。

- **计算B树的高度时一般不包括叶子结点/失败结点**

- 含有n个关键字的m阶B树，最小高度、最大高度是多少？

  - 最小高度：让每个结点尽可能满，即每个结点有m-1个关键字，m个分叉，则有：
    $$
    (m-1)(m^0+m^1+m^2+...+m^{h-1})≥n
    $$

  - 最大高度：让各层分叉尽可能少，即根结点只有2个分叉，其他结点只有$\lceil m/2\rceil$个分叉

## 六、散列查找




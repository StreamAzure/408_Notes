# 第一章 计算机系统概述

## 1.1 操作系统的概念和功能

- 操作系统：指控制和管理整个计算机系统的硬件和软件资源，并合理地组织调度计算机的工作和资源的分配，以提供给用户和其他软件方便的接口和环境，是计算机系统中最基本的**系统软件**

- 系统调用是应用程序请求操作系统服务的唯一方式

## 1.2 操作系统的特征

### 并发

并发是指两个或多个事件在同一时间间隔内发生。这些事件在宏观上是同时发生的，在微观上是交替发生的。

并行是指两个或多个时间在同一时刻同时发生。

单核CPU同一时刻只能执行一个程序，只能并发

多核CPU同一时刻能执行多个程序，可以并行

### 共享

共享即资源共享，是指系统中的资源可供内存中多个并发执行的进程共同使用

- 互斥共享：同一时间段内只允许一个进程访问该资源

- 同时共享：同一时间段内允许多个进程“同时”访问。“同时”是宏观上的同时，微观上可能是交替访问的

### 虚拟

如虚拟内存，虚拟处理器（实际上只有一个单核CPU，但在用户看来好像有6个CPU同时在服务）等

没有并发就没有虚拟

- 空分复用技术和时分复用技术

### 异步

多道程序环境下，允许多个程序并发执行，但进程的执行不是一贯到底的，而是受资源限制走走停停，以不可预知的速度推进

没有并发就没有异步

## 1.3 操作系统的发展和分类

### 手工操作阶段

![image-20220721221147785](assets/image-20220721221147785.png)

### 单道批处理系统

程序预先输入到磁带中，由监督程序负责控制作业的输入、输出

![image-20220721221135399](assets/image-20220721221135399.png)

优点：一定程度上缓解了人机速度矛盾，资源利用率有一定提升

缺点：同一时刻只有一个程序在运行。CPU有大量时间在等待I/O完成

### 多道批处理系统

![image-20220721221451023](assets/image-20220721221451023.png)

优点：多个程序并发执行，CPU和资源更能保持忙碌状态

缺点：用户响应时间长，没有人机交互功能，作业一旦提交就不能再干涉作业

### 分时操作系统

计算机以时间片为单位轮流为各个用户/作业服务

优点：用户请求可以被即时响应，解决人机交互问题。

缺点：不能优先处理一些紧急任务

### 实时操作系统

计算机需要在严格的时限内成立完事件。特点是及时性和可靠性

优点：能够优先响应一些紧急任务，某些紧急任务不需时间片排队

- 硬实时系统：必须在绝对严格的规定时间内完成处理（如导弹控制系统、自动驾驶系统）
- 软实时系统：能接受偶尔违反时间规定（如12306火车订票系统）

## 1.4 操作系统的运行机制

指令分为特权指令和非特权指令

CPU处于内核态才能执行特权指令，处于用户态只能执行非特权指令。

CPU内部的PSW寄存器的一个标志位用于标志当前处于用户态还是内核态。

CPU处于内核态时，可以执行一条特权指令，修改PSW标志位为用户态，从而使CPU从内核态转为用户态，即操作系统主动让出CPU使用权

CPU处于用户态时，若（被动或主动地）触发了中断，则硬件自动完成标志位的修改，使CPU从用户态转为内核态，操作系统强行接管CPU使用权

## 1.5 系统调用

凡是与共享资源有关的操作，都必须通过系统调用的方式向操作系统内和提出服务请求

- 陷入指令：是一条非特权指令，在用户态下执行。会立即引发一个内中断，使CPU进入核心态
- 系统调用请求是在用户态下发出的，对系统调用的相应处理则是在核心态下进行

## 1.6 操作系统体系结构

- 内核：由一系列内核程序构成，内核程序都在内核态执行
- 大内核：把进程管理、存储器管理、设备管理等管理功能及时钟管理、中断处理、原语等与硬件联系最紧密的功能都包含在内核里
- 微内核：只把时钟管理、中断处理、原语等与硬件联系最紧密的功能都包含在内核里；进程管理、存储器管理等可以在用户态执行
- 在请求系统服务时，大内核需要的CPU状态切换次数少，微内核则需要切换频繁



